# kitn Registry

Component registry for kitn -- a catalog of pre-built agents, tools, skills, and storage components served as static JSON via GitHub Pages.

Users install components with `kitn add <name>`. Each component lives in `components/<type>/<name>/` with a `manifest.json` and source files. The build script bundles these into `r/` for serving.

## Quick Reference

```bash
bun run validate    # Check imports and registryDependencies
bun run build       # Build registry JSON files into r/
bun run stage       # Create _staging/ symlinks for type-checking
bun run typecheck   # Stage + tsc --noEmit
bun test            # Run schema tests
```

## Directory Structure

```
components/          # Source components (edit these)
  agents/            # Agent components
  tools/             # Tool components
  skills/            # Skill components (markdown)
  storage/           # Storage components
  package/           # Shared packages (core, hono)
packages/            # Package source (kitn/core, kitn/hono)
r/                   # Built output -- DO NOT EDIT (generated by build)
  registry.json      # Index of all components (metadata only)
  agents/*.json      # Individual agent JSONs with embedded source
  tools/*.json       # Individual tool JSONs
  skills/*.json      # Individual skill JSONs
  storage/*.json     # Individual storage JSONs
scripts/             # Build, validate, and stage scripts
src/                 # Zod schemas and TypeScript types
schema/              # JSON Schema definitions
```

## Component Types

| Type | Directory Pattern | Source File Pattern | Export Convention |
|------|-------------------|---------------------|-------------------|
| Agent | `components/agents/<name>-agent/` | `<name>-agent.ts` | `UPPER_SNAKE_AGENT_CONFIG = { system, tools }` |
| Tool | `components/tools/<name>-tool/` | `<name>.ts` (NO `-tool` suffix) | `camelCaseTool = tool({ ... })` |
| Skill | `components/skills/<name>/` | `README.md` with frontmatter | N/A (markdown only) |
| Storage | `components/storage/<name>-store/` | `<name>-store.ts` | `create<Name>Store(dataDir)` factory |

### Naming -- Critical Detail

Tool directories use the `-tool` suffix but the **source file drops it**:
- Directory: `weather-tool/` -- File: `weather.ts` (NOT `weather-tool.ts`)
- Directory: `web-search-tool/` -- File: `web-search.ts`

All other types keep consistent naming:
- Agent: `weather-agent/weather-agent.ts`
- Storage: `memory-store/memory-store.ts`
- Skill: `eli5/README.md`

## Import Conventions

- **Cross-type imports**: Use `@kitn/<type>/<file>.js` aliases (e.g., `import { weatherTool } from "@kitn/tools/weather.js"`)
- **Same-directory imports**: Use relative paths (e.g., `import { helper } from "./utils.js"`)
- **`.js` extensions are required** on all imports (TypeScript convention for ESM)
- **Never use relative paths for cross-type imports** -- the validate script catches this

## Manifest Format (`manifest.json`)

Every component has a `manifest.json`:

```json
{
  "name": "weather-tool",
  "type": "kitn:tool",
  "description": "Short description of the component",
  "dependencies": ["ai", "zod"],
  "registryDependencies": [],
  "envVars": {},
  "files": ["weather.ts"],
  "docs": "Post-install instructions shown in the terminal",
  "categories": ["weather", "api"],
  "changelog": [
    { "version": "1.0.0", "date": "2026-02-25", "type": "initial", "note": "Initial release" }
  ]
}
```

| Field | Required | Description |
|-------|----------|-------------|
| `name` | Yes | Unique component identifier (matches directory name) |
| `type` | Yes | `kitn:agent`, `kitn:tool`, `kitn:skill`, or `kitn:storage` |
| `description` | Yes | Short description |
| `dependencies` | No | npm packages (e.g., `["ai", "zod"]`) |
| `registryDependencies` | No | Other kitn components this depends on |
| `envVars` | No | Object of `{ VAR_NAME: "description" }` |
| `files` | Yes | Array of source file names to include |
| `docs` | No | Post-install message |
| `categories` | No | Tags for discovery |
| `changelog` | No | Array of `{ version, date, type, note }` entries |

Changelog `type` values: `"initial"`, `"feature"`, `"fix"`, `"breaking"`

## Workflow

1. Create or modify files in `components/<type>/<name>/`
2. `bun run validate` -- check imports and dependencies
3. `bun run build` -- regenerate `r/` output
4. `bun test` -- run schema tests
5. Commit both source and `r/` output

## Common Pitfalls

- **Editing `r/` directly** -- always edit `components/`, then build
- **Wrong tool file name** -- tool source files drop the `-tool` suffix (`weather.ts`, not `weather-tool.ts`)
- **Missing `.js` extension** -- all imports need `.js` even in TypeScript
- **Relative cross-type imports** -- use `@kitn/tools/weather.js`, not `../../tools/weather-tool/weather.js`
- **Missing registryDependencies** -- if you import from another component, declare it
- **Wrong changelog type** -- use `initial` for new components, `feature`/`fix`/`breaking` for updates

## Reference Components

- Agent: `components/agents/weather-agent/` -- canonical agent pattern
- Tool: `components/tools/weather-tool/` -- canonical tool pattern (note `weather.ts`)
- Skill: `components/skills/eli5/` -- canonical skill pattern
- Storage: `components/storage/memory-store/` -- canonical storage pattern

## Recommended Plugins

- Context7 -- for up-to-date Vercel AI SDK documentation (`ai` package)
