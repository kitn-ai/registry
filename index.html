<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>kitn registries</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #09090b;
      --surface: #131318;
      --border: #26252e;
      --border-subtle: #1c1b24;
      --text: #f5f5f7;
      --text-secondary: #a1a1a6;
      --text-tertiary: #86868b;
      --brand: #e429a3;
      --brand-hover: #f04db8;
      --brand-subtle: rgba(228, 41, 163, 0.12);

      --type-agent: #6366f1;
      --type-tool: #a855f7;
      --type-skill: #f59e0b;
      --type-storage: #14b8a6;
      --type-package: #06b6d4;

      --tag-bg: rgba(245, 245, 247, 0.05);
      --tag-border: rgba(245, 245, 247, 0.09);
      --tag-text: #9d99a8;

      --dep-bg: rgba(228, 41, 163, 0.06);
      --dep-border: rgba(228, 41, 163, 0.14);
      --dep-text: #b88da6;

      --radius: 8px;
      --max-w: 860px;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.5;
      min-height: 100vh;
    }

    header {
      border-bottom: 1px solid var(--border);
      padding: 2rem 1.5rem 1.5rem;
    }

    header .inner {
      max-width: var(--max-w);
      margin: 0 auto;
    }

    header h1 {
      font-size: 1.25rem;
      font-weight: 600;
      letter-spacing: -0.02em;
    }

    header h1 span { color: var(--brand); }

    header p {
      color: var(--text-secondary);
      font-size: 0.875rem;
      margin-top: 0.25rem;
    }

    .registry-selector {
      max-width: var(--max-w);
      margin: 1.25rem auto 0;
      padding: 0 1.5rem;
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      align-items: center;
    }

    .registry-selector .label {
      font-size: 0.8125rem;
      color: var(--text-tertiary);
      margin-right: 0.25rem;
    }

    .registry-btn {
      padding: 0.375rem 0.75rem;
      border: 1px solid var(--border);
      border-radius: 100px;
      background: transparent;
      color: var(--text-secondary);
      font-size: 0.8125rem;
      cursor: pointer;
      transition: all 0.15s;
    }

    .registry-btn:hover { border-color: var(--text-tertiary); color: var(--text); }
    .registry-btn.active { background: var(--brand); color: #fff; border-color: var(--brand); }

    .registry-info {
      max-width: var(--max-w);
      margin: 0.75rem auto 0;
      padding: 0 1.5rem;
      font-size: 0.8125rem;
      color: var(--text-tertiary);
    }

    .registry-info a {
      color: var(--brand);
      text-decoration: none;
    }

    .registry-info a:hover { text-decoration: underline; }

    .search-bar {
      max-width: var(--max-w);
      margin: 1rem auto 0;
      padding: 0 1.5rem;
    }

    .search-bar input {
      width: 100%;
      padding: 0.625rem 1rem;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      color: var(--text);
      font-size: 0.875rem;
      outline: none;
      transition: border-color 0.2s;
    }

    .search-bar input::placeholder { color: var(--text-tertiary); }
    .search-bar input:focus { border-color: var(--brand); }

    .filters {
      max-width: var(--max-w);
      margin: 1rem auto 0;
      padding: 0 1.5rem;
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .filter-btn {
      padding: 0.375rem 0.75rem;
      border: 1px solid var(--border);
      border-radius: 100px;
      background: transparent;
      color: var(--text-secondary);
      font-size: 0.8125rem;
      cursor: pointer;
      transition: all 0.15s;
    }

    .filter-btn:hover { border-color: var(--text-tertiary); color: var(--text); }
    .filter-btn.active { background: var(--brand); color: #fff; border-color: var(--brand); }

    .count {
      max-width: var(--max-w);
      margin: 1.25rem auto 0;
      padding: 0 1.5rem;
      font-size: 0.8125rem;
      color: var(--text-tertiary);
    }

    main {
      max-width: var(--max-w);
      margin: 0.75rem auto 3rem;
      padding: 0 1.5rem;
    }

    .group { margin-top: 1.5rem; }

    .group-header {
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--text-tertiary);
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--border);
      margin-bottom: 0.25rem;
    }

    .item {
      display: grid;
      grid-template-columns: 1fr auto;
      align-items: start;
      gap: 1rem;
      padding: 0.75rem 0;
      border-bottom: 1px solid var(--border-subtle);
    }

    .item:last-child { border-bottom: none; }

    .item-name {
      font-size: 0.9375rem;
      font-weight: 500;
    }

    .item-desc {
      font-size: 0.8125rem;
      color: var(--text-secondary);
      margin-top: 0.125rem;
    }

    .item-meta {
      display: flex;
      gap: 0.375rem;
      margin-top: 0.375rem;
      flex-wrap: wrap;
    }

    .tag {
      font-size: 0.6875rem;
      padding: 0.125rem 0.5rem;
      border-radius: 100px;
      background: var(--tag-bg);
      border: 1px solid var(--tag-border);
      color: var(--tag-text);
    }

    .dep-tag {
      background: var(--dep-bg);
      border-color: var(--dep-border);
      color: var(--dep-text);
    }

    .copy-btn {
      white-space: nowrap;
      padding: 0.375rem 0.75rem;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: var(--surface);
      color: var(--text-secondary);
      font-size: 0.75rem;
      font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, monospace;
      cursor: pointer;
      transition: all 0.15s;
      align-self: center;
    }

    .copy-btn:hover { border-color: var(--brand); color: var(--text); }

    .copy-btn.copied {
      border-color: var(--brand);
      color: var(--brand);
    }

    .how-to {
      max-width: var(--max-w);
      margin: 2rem auto;
      padding: 2rem 1.5rem 0;
      border-top: 1px solid var(--border);
    }

    .how-to h2 {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.75rem;
    }

    .how-to p {
      font-size: 0.875rem;
      color: var(--text-secondary);
      margin-bottom: 0.75rem;
    }

    .how-to code {
      font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, monospace;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 0.125rem 0.375rem;
      font-size: 0.8125rem;
    }

    .how-to a {
      color: var(--brand);
      text-decoration: none;
    }

    .how-to a:hover { text-decoration: underline; }

    .empty {
      text-align: center;
      padding: 3rem 1rem;
      color: var(--text-tertiary);
      font-size: 0.875rem;
    }

    .loading {
      text-align: center;
      padding: 4rem 1rem;
      color: var(--text-tertiary);
    }

    .type-color-agent { color: var(--type-agent); }
    .type-color-tool { color: var(--type-tool); }
    .type-color-skill { color: var(--type-skill); }
    .type-color-storage { color: var(--type-storage); }
    .type-color-package { color: var(--type-package); }

    footer {
      border-top: 1px solid var(--border);
      padding: 1.5rem;
      text-align: center;
    }

    footer a {
      color: var(--text-tertiary);
      font-size: 0.8125rem;
      text-decoration: none;
    }

    footer a:hover { color: var(--brand); }

    @media (max-width: 640px) {
      .item { grid-template-columns: 1fr; gap: 0.5rem; }
      .copy-btn { justify-self: start; }
    }
  </style>
</head>
<body>
  <header>
    <div class="inner">
      <h1><span>kitn</span> registries</h1>
      <p>Public directory of kitn component registries</p>
    </div>
  </header>

  <div class="registry-selector" id="registrySelector">
    <span class="label">Registry:</span>
  </div>
  <div class="registry-info" id="registryInfo"></div>

  <div class="search-bar">
    <input type="text" id="search" placeholder="Search components..." autocomplete="off" spellcheck="false">
  </div>

  <div class="filters" id="filters"></div>
  <div class="count" id="count"></div>
  <main id="content"><div class="loading">Loading registries...</div></main>

  <div class="how-to" id="howTo" style="display:none">
    <h2>Add your registry</h2>
    <p>
      Host a kitn-compatible component registry, then
      <a href="https://github.com/kitn-ai/registry">open a PR</a>
      to add your entry to <code>registries.json</code>.
    </p>
    <p>Users can then install your components with:</p>
    <p><code>kitn registry add @yourteam https://your-domain.com/r/{type}/{name}.json</code></p>
  </div>

  <footer>
    <a href="https://github.com/kitn-ai/kitn">github.com/kitn-ai/kitn</a>
  </footer>

  <script>
    const TYPE_ORDER = ["agent", "tool", "skill", "storage", "package"];
    const TYPE_LABELS = { agent: "Agents", tool: "Tools", skill: "Skills", storage: "Storage", package: "Packages" };

    let registries = [];
    let activeRegistry = null;
    let items = [];
    let activeType = null;
    let searchQuery = "";

    async function init() {
      try {
        const res = await fetch("./registries.json");
        if (!res.ok) throw new Error(res.statusText);
        registries = await res.json();
        buildRegistrySelector();
        document.getElementById("howTo").style.display = "";

        if (registries.length > 0) {
          await selectRegistry(registries[0]);
        } else {
          document.getElementById("content").innerHTML =
            `<div class="empty">No registries registered yet.</div>`;
        }
      } catch (err) {
        document.getElementById("content").innerHTML =
          `<div class="empty">Failed to load registries.<br><span style="color:var(--text-tertiary)">${err.message}</span></div>`;
      }
    }

    function buildRegistrySelector() {
      const container = document.getElementById("registrySelector");
      for (const reg of registries) {
        const btn = document.createElement("button");
        btn.className = "registry-btn";
        btn.textContent = reg.name;
        btn.dataset.name = reg.name;
        btn.onclick = () => selectRegistry(reg);
        container.appendChild(btn);
      }
    }

    function resolveIndexUrl(urlTemplate) {
      const idx = urlTemplate.indexOf("{type}");
      if (idx === -1) return urlTemplate;
      return urlTemplate.substring(0, idx) + "registry.json";
    }

    async function selectRegistry(reg) {
      activeRegistry = reg;
      activeType = null;
      searchQuery = "";
      document.getElementById("search").value = "";

      document.querySelectorAll(".registry-btn").forEach(btn => {
        btn.classList.toggle("active", btn.dataset.name === reg.name);
      });

      const info = document.getElementById("registryInfo");
      const parts = [];
      if (reg.description) parts.push(reg.description);
      if (reg.homepage) parts.push(`<a href="${esc(reg.homepage)}">${esc(reg.homepage)}</a>`);
      info.innerHTML = parts.join(" &mdash; ");

      document.getElementById("content").innerHTML = `<div class="loading">Loading ${esc(reg.name)} components...</div>`;
      document.getElementById("filters").innerHTML = "";
      document.getElementById("count").textContent = "";

      try {
        const indexUrl = resolveIndexUrl(reg.url);
        const res = await fetch(indexUrl);
        if (!res.ok) throw new Error(`${res.status} ${res.statusText}`);
        const data = await res.json();
        items = data.items.map(item => ({
          ...item,
          typeShort: item.type.replace("kitn:", ""),
        }));
        buildFilters();
        render();
      } catch (err) {
        document.getElementById("content").innerHTML =
          `<div class="empty">Failed to load components from ${esc(reg.name)}.<br><span style="color:var(--text-tertiary)">${err.message}</span></div>`;
      }
    }

    function buildFilters() {
      const counts = {};
      for (const item of items) {
        counts[item.typeShort] = (counts[item.typeShort] || 0) + 1;
      }

      const container = document.getElementById("filters");
      container.innerHTML = "";

      const allBtn = document.createElement("button");
      allBtn.className = "filter-btn active";
      allBtn.textContent = `All (${items.length})`;
      allBtn.onclick = () => setFilter(null);
      container.appendChild(allBtn);

      for (const type of TYPE_ORDER) {
        if (!counts[type]) continue;
        const btn = document.createElement("button");
        btn.className = "filter-btn";
        btn.dataset.type = type;
        btn.textContent = `${TYPE_LABELS[type]} (${counts[type]})`;
        btn.onclick = () => setFilter(type);
        container.appendChild(btn);
      }
    }

    function setFilter(type) {
      activeType = type;
      document.querySelectorAll(".filter-btn").forEach(btn => {
        btn.classList.toggle("active",
          type === null ? !btn.dataset.type : btn.dataset.type === type
        );
      });
      render();
    }

    function render() {
      const q = searchQuery.toLowerCase();
      const ns = activeRegistry ? activeRegistry.name : "";
      const isDefault = ns === "@kitn";

      const filtered = items.filter(item => {
        if (activeType && item.typeShort !== activeType) return false;
        if (q) {
          return item.name.toLowerCase().includes(q) ||
                 item.description.toLowerCase().includes(q) ||
                 (item.categories || []).some(c => c.toLowerCase().includes(q));
        }
        return true;
      });

      document.getElementById("count").textContent =
        `${filtered.length} component${filtered.length !== 1 ? "s" : ""}`;

      if (filtered.length === 0) {
        document.getElementById("content").innerHTML =
          `<div class="empty">No components match your search.</div>`;
        return;
      }

      const groups = {};
      for (const item of filtered) {
        if (!groups[item.typeShort]) groups[item.typeShort] = [];
        groups[item.typeShort].push(item);
      }

      let html = "";
      for (const type of TYPE_ORDER) {
        const group = groups[type];
        if (!group) continue;
        group.sort((a, b) => a.name.localeCompare(b.name));

        html += `<div class="group">`;
        html += `<div class="group-header">${TYPE_LABELS[type]}</div>`;

        for (const item of group) {
          const cats = (item.categories || [])
            .map(c => `<span class="tag">${esc(c)}</span>`)
            .join("");
          const deps = (item.registryDependencies || [])
            .map(d => `<span class="tag dep-tag">${esc(d)}</span>`)
            .join("");
          const meta = cats + deps;

          const addName = isDefault ? item.name : `${ns}/${item.name}`;

          html += `<div class="item">
            <div>
              <div class="item-name"><span class="type-color-${item.typeShort}">${esc(item.name)}</span></div>
              <div class="item-desc">${esc(item.description)}</div>
              ${meta ? `<div class="item-meta">${meta}</div>` : ""}
            </div>
            <button class="copy-btn" onclick="copyInstall(this, '${esc(addName)}')">kitn add ${esc(addName)}</button>
          </div>`;
        }
        html += `</div>`;
      }

      document.getElementById("content").innerHTML = html;
    }

    function copyInstall(btn, name) {
      navigator.clipboard.writeText(`kitn add ${name}`).then(() => {
        btn.textContent = "copied!";
        btn.classList.add("copied");
        setTimeout(() => {
          btn.textContent = `kitn add ${name}`;
          btn.classList.remove("copied");
        }, 1500);
      });
    }

    function esc(s) {
      const d = document.createElement("div");
      d.textContent = s;
      return d.innerHTML;
    }

    document.getElementById("search").addEventListener("input", e => {
      searchQuery = e.target.value;
      render();
    });

    init();
  </script>
</body>
</html>
